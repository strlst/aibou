# valkey.conf â€” tuned for session storage with persistence

# networking settings
bind 0.0.0.0
port 6379
# using private docker network anyways
protected-mode no

# general settings
daemonize no
loglevel notice
databases 16

# persistence (RDB snapshots)
# save a snapshot if at least N keys changed in M seconds
# 1 key changed in 1 hour
save 3600 1
# 100 keys changed in 5 minutes
save 300  100
# 10000 keys changed in 1 minute
save 60   10000  

rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb
dir /data

# persistence AOF (Append-Only File)
# additionally rely on AOF for durability
appendonly yes
appendfilename "appendonly.aof"
# fsync once per second (good balance)
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# memory settings
maxmemory 256mb
# evict least-recently-used keys when full
maxmemory-policy allkeys-lru